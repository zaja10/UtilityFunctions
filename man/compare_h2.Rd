% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compare_heritability.r
\name{compare_h2}
\alias{compare_h2}
\title{Compare Site-Specific Heritability Metrics for FA Models}
\usage{
compare_h2(
  model,
  fa_object,
  grm = NULL,
  classify = NULL,
  methods = c("Cullis", "Oakey", "Standard")
)
}
\arguments{
\item{model}{A fitted \code{asreml} object.}

\item{fa_object}{An object of class \code{fa_asreml} produced by \code{fa.asreml()}.}

\item{grm}{Optional. The genomic relationship matrix (inverse not required).
Required only for the "Oakey" method.}

\item{classify}{Character string. The prediction term. If NULL, attempts to detect
automatically from \code{fa_object$meta$classify}.}

\item{methods}{Character vector. Metrics to calculate: c("Cullis", "Oakey", "Standard").}
}
\value{
A data.frame summarizing H2, Genetic Variance (Vg), and Error Metrics per Site.
}
\description{
Calculates and compares three standard heritability metrics (Cullis, Oakey, Standard)
for each environment within a Factor Analytic (FA) or Reduced Rank (RR) model.
It leverages the heterogeneous genetic variances ($\sigma^2_{g_j}$) estimated by the FA model.
}
\details{
\strong{Metrics:}
\itemize{
  \item \strong{Standard:} \eqn{1 - (PEV / V_g)}. Simple but often biased in unbalanced trials.
  \item \strong{Cullis:} \eqn{1 - (\bar{v}_{\Delta}^{BLUP} / 2V_g)}. The standard for phenotypic trials.
  \item \strong{Oakey:} \eqn{1 - tr(C^{22}G^{-1})/n}. The gold standard for genomic trials.
}

\strong{Optimizations:}
This function implements two key optimizations for large-scale genomic trials:
\enumerate{
  \item \strong{Split Predictions:} Predictions are run per-site to avoid calculating massive
  PEV matrices (e.g., 20k x 20k) that would exhaust memory.
  \item \strong{Trace Trick (Oakey):} Uses \code{sum(A * B)} instead of \code{trace(A \%*\% B)}
  to calculate the trace of the product of two symmetric matrices, drastically reducing
  computation time.
}
}
