% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_extraction.r
\name{fa.asreml}
\alias{fa.asreml}
\title{Extract and Rotate Factor Analytic Model Parameters}
\usage{
fa.asreml(model, classify, psi_term = NULL, rotate = TRUE)
}
\arguments{
\item{model}{A fitted object of class \code{asreml}.}

\item{classify}{A character string defining the main latent model term.
Must match the ASReml syntax used in the model call.
\itemize{
  \item Standard FA: \code{"fa(Site, 2):Genotype"}
  \item Genomic FA: \code{"fa(Site, 2):vm(Genotype, grm)"}
  \item Reduced Rank: \code{"rr(Site, 2):Genotype"}
}}

\item{psi_term}{A character string defining the specific variance term (Optional).
Required only for **Reduced Rank** models where the diagonal variance is fitted
separately (e.g., \code{"diag(Site):Genotype"}). If NULL for an RR model,
specific variances are assumed to be zero.}

\item{rotate}{Logical. If \code{TRUE} (default), loadings and scores are rotated
to the Principal Component solution via SVD. If \code{FALSE}, raw parameters
are returned (warning: FAST indices may be invalid without rotation).}
}
\value{
An object of class \code{fa_asreml} containing:
\describe{
  \item{loadings}{A list containing \code{raw} and \code{rotated} site loading matrices.}
  \item{scores}{A list containing \code{raw} and \code{rotated} genotype score matrices (BLUPs).}
  \item{var_comp}{A list containing the extracted specific variances (\code{psi}) and a table of Variance Accounted For (\code{vaf}).}
  \item{matrices}{The estimated Genetic Covariance (\code{G}) and Genetic Correlation (\code{Cor}) matrices.}
  \item{fast}{A dataframe containing the FAST indices: Overall Performance (\code{OP}) and Stability (\code{RMSD}).}
  \item{meta}{Metadata regarding the model structure (k factors, model type).}
}
}
\description{
The primary engine of the toolkit. This function parses a fitted ASReml-R model object to
extract loadings, scores (BLUPs), and specific variances from a Factor Analytic (FA)
or Reduced Rank (RR) model term.

It performs a Singular Value Decomposition (SVD) rotation to align the solution
with the Principal Component axis. This rotation is required to validly calculate
the **Factor Analytic Selection Tools (FAST)** indices (Overall Performance and Stability)
as proposed by Smith & Cullis (2018).
}
\details{
\strong{Rotation Strategy:}
Raw FA solutions from ASReml are not unique. This function rotates the loadings (\eqn{\Lambda})
and scores (\eqn{f}) such that:
\deqn{\Lambda_{rot} = \Lambda V}
\deqn{f_{rot} = f V}
where \eqn{V} is the matrix of eigenvectors from the SVD of \eqn{\Lambda}. This ensures that
Factor 1 captures the maximum amount of genetic variance, allowing it to be interpreted
as "Overall Performance."

\strong{FAST Indices:}
\itemize{
  \item \strong{OP (Overall Performance):} The predicted genetic value of a variety
  at the mean environmental loading of Factor 1.
  \item \strong{RMSD (Stability):} The Root Mean Square Deviation of a variety's
  predicted effect from the Factor 1 regression line. It quantifies the amount of
  GxE interaction (instability) driven by Factors 2..k.
}
}
\references{
Smith, A. B., & Cullis, B. R. (2018). Plant breeding selection tools built on
factor analytic mixed models for multi-environment trial data. \emph{Euphytica}, 214(8).
}
